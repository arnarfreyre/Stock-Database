# Modular Plot Configuration System

A comprehensive, scalable system for managing chart configurations and fullscreen functionality across the financial analysis application.

## Overview

This system provides:
- **Centralized Configuration**: All plot types and their options in one place
- **Fullscreen Management**: Universal fullscreen capability for all charts
- **Modular Design**: Easy to add new plot types and options
- **Configurable Controls**: Each plot can have different sidebar options
- **Future-Proof**: Scalable architecture for adding new features

## Components

### 1. Plot Configuration (`plot-config.js`)
Central configuration system defining plot types and their capabilities.

### 2. Fullscreen Manager (`fullscreen-manager.js`)
Handles fullscreen functionality, resizable charts, and sidebar management.

### 3. Fullscreen Styles (`fullscreen-styles.css`)
CSS styles for fullscreen mode, sidebar, and interactive elements.

## Current Plot Types

### Stock Prices (`stock-prices`)
- **Fullscreen**: ✅ Enabled
- **Options**: Moving averages (5, 20, 40-day), date range selection
- **Chart Type**: Line chart
- **Use Case**: Main stock price visualization with technical indicators

### Volume (`volume`)
- **Fullscreen**: ✅ Enabled
- **Options**: Volume bars, date range selection
- **Chart Type**: Bar chart
- **Use Case**: Trading volume analysis

### Cumulative Returns (`cumulative-returns`)
- **Fullscreen**: ✅ Enabled
- **Options**: Return types (overnight, intraday), date range selection
- **Chart Type**: Line chart
- **Use Case**: Overnight vs intraday return comparison

### Volatility (`volatility`)
- **Fullscreen**: ✅ Enabled
- **Options**: Volatility measures (daily, weekly, monthly, annualized), date range
- **Chart Type**: Line chart
- **Use Case**: Volatility analysis and risk assessment

## Usage

### Adding Fullscreen to a Chart

1. **HTML Structure**:
```html
<div class=\"chart-container\" id=\"myChartContainer\">
    <div class=\"formula-box\" style=\"position: relative;\">
        <!-- Fullscreen button -->
        <button class=\"fullscreen-btn\" onclick=\"FullscreenManager.instance.toggleFullscreen('myChartContainer', 'plot-type', chartInstance)\" title=\"Fullscreen\">
            <svg width=\"20\" height=\"20\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"2\">
                <path d=\"M8 3H5a2 2 0 0 0-2 2v3m18 0V5a2 2 0 0 0-2-2h-3m0 18h3a2 2 0 0 0 2-2v-3M3 16v3a2 2 0 0 0 2 2h3\"/>
            </svg>
        </button>
        <canvas id=\"myChart\"></canvas>
    </div>
    
    <!-- Fullscreen Sidebar (auto-populated) -->
    <div class=\"fullscreen-sidebar\" style=\"display: none;\">
        <button class=\"exit-fullscreen-btn\" onclick=\"FullscreenManager.instance.exitFullscreen()\" title=\"Exit Fullscreen\">
            <svg width=\"20\" height=\"20\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"2\">
                <path d=\"M8 3v3a2 2 0 0 1-2 2H3m18 0h-3a2 2 0 0 1-2-2V3m0 18v-3a2 2 0 0 1 2-2h3M3 16h3a2 2 0 0 1 2 2v3\"/>
            </svg>
        </button>
        
        <div class=\"sidebar-content\">
            <h3>Chart Options</h3>
            <!-- Content auto-generated by PlotConfig -->
        </div>
    </div>
</div>
```

2. **Include Required Files**:
```html
<link rel=\"stylesheet\" href=\"js/fullscreen-styles.css\">
<script src=\"js/plot-config.js\"></script>
<script src=\"js/fullscreen-manager.js\"></script>
```

3. **Chart Integration**:
```javascript
// Chart.js instance
let myChart = new Chart(ctx, chartConfig);

// Fullscreen button calls
FullscreenManager.instance.toggleFullscreen('myChartContainer', 'plot-type', myChart);
```

### Adding a New Plot Type

1. **Define Configuration**:
``` javascript
// In plot-config.js, add to plotConfigs object:
'my-new-plot': {
    id: 'my-new-plot',
    title: 'My New Plot Type',
    fullscreenEnabled: true,
    chartType: 'line',
    options: {
        customOption: {
            enabled: true,
            label: 'Custom Controls',
            controls: [
                { id: 'option1', label: 'Option 1', defaultEnabled: true, color: '#e74c3c' },
                { id: 'option2', label: 'Option 2', defaultEnabled: false, color: '#3498db' }
            ]
        },
        dateRange: {
            enabled: true,
            label: 'Date Range',
            presets: [
                { id: '1month', label: '1M', value: 1, unit: 'months' },
                { id: '3months', label: '3M', value: 3, unit: 'months' },
                { id: '1year', label: '1Y', value: 1, unit: 'year' }
            ],
            customEnabled: true
        }
    },
    sidebar: {
        width: 250,
        backgroundColor: 'linear-gradient(to bottom, rgba(20, 20, 20, 0.95), rgba(30, 30, 30, 0.95))'
    }
}
```

2. **Use in HTML**:
```html
<button class=\"fullscreen-btn\" onclick=\"FullscreenManager.instance.toggleFullscreen('chartContainer', 'my-new-plot', chartInstance)\">
```

### Customizing Options

#### Available Option Types:

1. **Moving Averages**:
``` javascript
movingAverages: {
    enabled: true,
    label: 'Technical Indicators',
    controls: [
        { id: 'ma5', label: '5-Day MA', defaultEnabled: true, color: '#3498db' },
        { id: 'ma20', label: '20-Day MA', defaultEnabled: true, color: '#27ae60' }
    ]
}
```

2. **Date Range**:
``` javascript
dateRange: {
    enabled: true,
    label: 'Date Range',
    presets: [
        { id: '1month', label: '1M', value: 1, unit: 'months' },
        { id: '6months', label: '6M', value: 6, unit: 'months' }
    ],
    customEnabled: true  // Shows manual date picker
}
```

3. **Custom Controls**:
``` javascript
customSection: {
    enabled: true,
    label: 'Display Options',
    controls: [
        { id: 'showGrid', label: 'Show Grid', defaultEnabled: true },
        { id: 'showLegend', label: 'Show Legend', defaultEnabled: false, disabled: true }
    ]
}
```

#### Control Properties:
- `id`: Unique identifier for the control
- `label`: Display text
- `defaultEnabled`: Whether enabled by default
- `color`: Associated color (for chart elements)
- `disabled`: Whether the control is disabled

## API Reference

### PlotConfig Methods

#### `PlotConfig.get(plotId)`
Get configuration for a specific plot type.
```javascript
const config = PlotConfig.get('stock-prices');
```

#### `PlotConfig.isFullscreenEnabled(plotId)`
Check if fullscreen is enabled for a plot type.
```javascript
const canFullscreen = PlotConfig.isFullscreenEnabled('cumulative-returns'); // true
```

#### `PlotConfig.getEnabledOptions(plotId)`
Get only enabled options for a plot type.
```javascript
const enabledOptions = PlotConfig.getEnabledOptions('stock-prices');
// Returns: { movingAverages: {...}, dateRange: {...} }
```

#### `PlotConfig.generateSidebarHTML(plotId, chartType)`
Generate HTML for fullscreen sidebar.
```javascript
const sidebarHTML = PlotConfig.generateSidebarHTML('stock-prices', 'price');
```

#### `PlotConfig.setDateRange(value, unit, chartType)`
Set date range programmatically.
``` javascript
PlotConfig.setDateRange(6, 'months', 'price'); // Set to 6 months
PlotConfig.setDateRange('all', null, 'returns'); // Set to maximum range
```

### FullscreenManager Methods

#### `FullscreenManager.instance.toggleFullscreen(containerId, plotId, chart)`
Toggle fullscreen mode for a chart.
```javascript
FullscreenManager.instance.toggleFullscreen('chartContainer', 'stock-prices', myChart);
```

#### `FullscreenManager.instance.exitFullscreen()`
Exit fullscreen mode.
```javascript
FullscreenManager.instance.exitFullscreen();
```

## Configuration Options

### Plot Configuration Schema
``` javascript
{
    id: 'plot-id',                    // Unique identifier
    title: 'Plot Title',              // Display name
    fullscreenEnabled: true|false,    // Enable/disable fullscreen
    chartType: 'line'|'bar',         // Chart type
    options: {                        // Available options
        optionName: {
            enabled: true|false,       // Whether option is available
            label: 'Option Label',     // Display label
            controls: [...],           // Control definitions
            presets: [...],            // Date range presets (for dateRange)
            customEnabled: true|false  // Custom date picker (for dateRange)
        }
    },
    sidebar: {
        width: 250,                   // Sidebar width in pixels
        backgroundColor: 'gradient'    // Background style
    }
}
```

## Event Handling

### Chart Update Callbacks
The system automatically triggers chart updates when options change. It looks for these global functions:
- `loadStockData()` - For index.html stock charts
- `calculateReturns()` - For cumulative returns charts
- `updateChart()` - Generic fallback

### Custom Callbacks
You can define custom option change handlers:
```javascript
// Set up in FullscreenManager options
const options = {
    onControlChange: function(controlId, isEnabled, optionKey) {
        console.log(`Control ${controlId} in ${optionKey} is now ${isEnabled ? 'enabled' : 'disabled'}`);
        // Custom logic here
    }
};
```

## File Structure
```
src/frontend/js/
├── plot-config.js              # Central configuration
├── fullscreen-manager.js       # Fullscreen functionality
├── fullscreen-styles.css       # Fullscreen styling
└── README-PlotConfig.md        # This documentation
```

## Examples

### Stock Prices Chart (index.html)
```html
<div class=\"chart-container\" id=\"priceChartContainer\">
    <div class=\"formula-box\">
        <button class=\"fullscreen-btn\" onclick=\"FullscreenManager.instance.toggleFullscreen('priceChartContainer', 'stock-prices', priceChart)\">
        <canvas id=\"priceChart\"></canvas>
    </div>
</div>
```

### Cumulative Returns Chart (cumulative-returns.html)
```html
<div class=\"chart-container\" id=\"returnsChartContainer\">
    <div class=\"formula-box\">
        <button class=\"fullscreen-btn\" onclick=\"FullscreenManager.instance.toggleFullscreen('returnsChartContainer', 'cumulative-returns', returnsChart)\">
        <canvas id=\"returnsChart\"></canvas>
    </div>
</div>
```

## Best Practices

1. **Always validate plot configuration**:
```javascript
if (PlotConfig.validate('my-plot-type')) {
    // Safe to use
}
```

2. **Use appropriate chart identifiers**:
```javascript
// Good: Descriptive and unique
'cumulative-returns-container'

// Bad: Generic and ambiguous  
'chart1'
```

3. **Keep configurations focused**:
``` javascript
// Good: Specific to the chart type
options: {
    returnTypes: { enabled: true, ... }
}

// Bad: Generic catch-all
options: {
    allOptions: { enabled: true, ... }
}
```

4. **Provide meaningful labels**:
``` javascript
// Good: Clear and descriptive
{ id: 'overnight', label: 'Overnight (Close → Open)', ... }

// Bad: Technical jargon only
{ id: 'ov', label: 'OV', ... }
```

## Future Enhancements

### Planned Features
- Export/import configurations
- Theme customization
- Multiple chart layouts
- Advanced technical indicators
- Real-time data integration
- Mobile-optimized fullscreen

### Extensibility Points
- Custom option renderers
- Plugin architecture for new chart types
- Dynamic configuration loading
- User preference persistence
- API-driven configurations

This modular system provides a solid foundation for current needs while remaining flexible for future financial analysis tools and visualizations.